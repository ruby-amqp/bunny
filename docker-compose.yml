services:
  rabbitmq:
    image: ${RABBITMQ_IMAGE:-rabbitmq:4.0.6-management}
    environment:
      RABBITMQ_NODENAME: bunny
      # see CONTRIBUTING.md
      BUNNY_RABBITMQ_HOSTNAME: mercurio
      # send logs to stdout
      RABBITMQ_LOGS: '-'
      RABBITMQ_SASL_LOGS: '-'
      RABBITMQ_CONFIG_FILE: /spec/rabbitmq_config/rabbitmq.conf
      RABBITMQ_ENABLED_PLUGINS_FILE: /spec/rabbitmq_config/enabled_plugins
    ports:
      - 5671-5672:5671-5672
      - 15672:15672
    volumes:
      - ./spec:/spec:ro
    healthcheck:
      test: ["CMD", "rabbitmqctl", "status"]
      interval: 5s
      retries: 5
      start_period: 5s
      timeout: 5s
  toxiproxy:
      container_name: toxiproxy
      image: shopify/toxiproxy
      ports:
        - 8474:8474
        - 11111:11111
      depends_on:
        rabbitmq:
          condition: service_healthy
